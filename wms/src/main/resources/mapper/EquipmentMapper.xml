<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hczx.wms.dao.EquipmentDao">

    <!-- 查找设备信息 -->
    <select id="listEquipmentInfo" resultType="com.hczx.wms.entity.enquipmententities.EquipmentInfoEntity">
        select
        id id,
        equipmentRfid equipmentRfid,
        equipmentName equipmentName,
        equipmentGrade equipmentGrade,
        equipmentClass equipmentClass,
        equipmentPreId equipmentPreId,
        equipmentCompanyId equipmentCompanyId,
        equipmentCompanyName equipmentCompanyName,
        createTime createTime,
        editTime editTime,
        schemeId schemeId,
        schemeName schemeName,
        validState validState,
        occupyState occupyState
        from equipment
<!--        <where>-->
<!--            <if test="uname!=null and uname!='' ">-->
<!--                and uname like #{uname}-->
<!--            </if>-->
<!--        </where>-->
        <if test="page!=null and size!=null">
            limit #{page},#{size}
        </if>
    </select>

    <!-- 查找设备信息数量 -->
    <select id="countEquipmentInfo" resultType="java.lang.Long">
        select
        count(*)
        from equipment
        where 1=1
        <!--        <where>-->
        <!--            <if test="uname!=null and uname!='' ">-->
        <!--                and uname like #{uname}-->
        <!--            </if>-->
        <!--        </where>-->

    </select>

    <!-- 查找树形设备信息 -->
    <select id="zTreeEquipmentInfo" resultType="com.hczx.wms.entity.enquipmententities.EquipmentZtreeNode">
        SELECT
            com.id pId,
            com.companyName comName,
            emt.id emtId,
            emt.id id,
            emt.equipmentName name,
            <!--false AS open,-->
            true AS nocheck
        FROM
            equipment emt
            LEFT JOIN company com ON ( emt.equipmentCompanyId = com.id )
        WHERE
            emt.validState = '1'
            AND emt.equipmentGrade = '1'
            AND com.validState = '1'
    </select>

    <!--作废设备-->
    <update id="nullifyByIds">
        UPDATE
        equipment
        SET validState = '0'
        WHERE id IN
        <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
            #{item}
        </foreach>
    </update>
</mapper>